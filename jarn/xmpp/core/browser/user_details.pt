<metal:userdetails tal:condition="view/available"
  tal:define="user_id view/user_id;
              fullname view/fullname">
    <li tal:attributes="id string:online-users-$user_id">
        <a href="#" class="user-details-toggle collapsed" title="Click to toggle user's details"
           tal:content="fullname">Jon Doe</a>
        <div class="user-details-form">
            <a tal:attributes="href string:@@pubsub-feed?node=$user_id;
                               title string:Personal stream of $fullname">
               <img tal:attributes="alt string:Personal stream of $fullname;
                                    src view/portrait_url" />
            </a>
            <form class="sendXMPPMessage" action="" method="post">
                <input type="text" name="message" placeholder=""
                       tal:attributes="placeholder string:Personal message;
                                       data-recipient view/jid"/>
                <div class="formControls">
                    <input type="submit" value="Send" name="sendButton" class="submit-widget button-field"/>
                </div>
            </form>
            <a href="#" title=""
               tal:attributes="href string:@@pubsub-feed?node=$user_id;
                               title string:$fullname">
                Personal Stream
            </a>
        </div>
    </li>
</metal:userdetails>